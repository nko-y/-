#### 描边

分为内描边(物体贴图上面的描边) 和 外描边(back facing)两种

（1）Back Facing描边法

- 基本方法：

  - 第一次绘制角色，第二次绘制描边。

  - 绘制描边的时候，在顶点着色器将顶点沿着法线方向位移一段距离使得模型轮廓放大渲染作为描边

  - 描边绘制时使用cull front，这样描边和角色重叠的部分会因为不能通过深度检测而被cull掉保证不遮挡角色

  - 两次绘制可以颠倒不过后绘制描边可以通过深度检测过滤到很多描边绘制像素修正摄像机距离问题 $\rightarrow$ 距离拉进之后描边变粗

- 描边的宽度不应该相对于世界空间不变，应该使用NDC空间的距离外扩
  - 由于屏幕分辨率比率不同，因而NDC空间的距离外扩应该适配窗口分辨率这样才能保持粗细一致

- 不光滑物体断边问题(比如正方形数据边角断裂)

  - 【核心：将在相同位置顶点的法线数据进行平均】，将算出来的新法线写入模型切线数据中，使用这个切线数据进行法线外扩

  - 注：这里写入切向数据是因为只有发现和切线数据会随着骨骼动画而改变所以如果渲染的是有骨骼动画的角色写入切线就不用额外处理

  - 注：如果是需要原始切线的，那就可以把平均法线数据转换为切空间再保存到顶点相关数据上

- 顶点色：模型顶点颜色的四个通道可以对模型描边的粗细、显隐、距离缩放进行精细的控制

（2）Sobel算子的边缘检测

（3）模板测试：

- 在绘制物体前，把模板方程设置为GL_ALWAYS，用1更新物体将被渲染的片段。渲染物体，写入模板缓冲
- 关闭模板写入和深度测试
- 每个物体放大一点点，使用一个不同的片段着色器用来输入一个纯颜色
- 再次绘制物体但只是当它们的片段模板值不为1时才进行

（4）内描边：在物体贴图上面的描边，这种描边有一个问题就是放大之后容易产生锯齿

- 本村线：表现衣服上的褶皱等折痕，所有的线横平竖直



#### 着色

（1）特征：

- 减少色阶数量：赛璐璐风格通常只有明暗两个色阶(明暗交界变化非常明显)，厚涂风格色阶更多明暗交界变化会柔和很多
- 冷暖色调分离：根据明暗关系为明面和暗面分配不同色调的颜色
- 对明暗区域的手绘控制：
  - 通过threadshold贴图法线方向对光照计算进行手绘风格的控制
  - 灯光方向控制(为了让每个角色都有最佳表现最好每个角色都有一盏自己的灯光方向甚至当这个角色转向时灯光也跟着角色做一定程度的转向)
  - 法线方向控制：直接编辑法线 or 创建一个平滑的简单模型将其法线传递到复杂物体上(Maya自带法线传递功能)
  - ilmTexture贴图：绿色通道控制漫反射的阴影阈值，红色通道控制高光强度，蓝色通道控制高光范围

（2）方法：

- 将法线方向和光线方向的点积映射到0-1的范围：双色阶渲染、smoothstep柔化明暗边界(根据输入返回一个范围在0-1区间的平滑过渡曲线)、Ramp贴图(对ramp贴图采样获得过渡值)



#### 边缘光和后处理

（1）边缘光：可以凸显边缘

- 根据视线和法线的点积计算一个系数用于确定边缘程度，并据此乘以边缘光颜色值计算。为了防止边缘光过硬可以用smoothstep函数
- 平面与视线接近垂直时会导致整个平面都有边缘光，可以使用边缘光mask贴图对边缘光区域调整

（2）Bloom后处理实现：

- 通常的Bloom实现：通过一个阈值对需要处理的图像经过亮度提取(0.299R + 0.587G + 0.114B)，对经过亮度提取的图像进行模糊处理(高斯模糊)，叠加原图和模糊处理后的图像
- 卡通渲染的特殊要求：需要能够自己控制曝光区域，将颜色写入alpha通道利用alpha通道值来控制曝光度的方法，由于半透明的物体混合也需要用到alpha可以通过额外的pass单独写入alpha来解决



#### PBR+卡通

（1）二分色的卡通渲染有哪些不足：应用于场景时，由于场景包含了非常丰富的材质只靠二分色难以表现足够多的材质

（2）基本思想：卡通渲染表现比较擅长的皮肤、布料等材质，PBR表现质感高的部分，通过蒙版对两种光照计算进行区分









































